<ons-page>
        <ons-toolbar class="toolbar" style="background-color: white;position: fixed;">
            <div class="left" style="padding-left: 3%;">
                <ons-back-button></ons-back-button>
            </div>
            <div class="center" style="color:#898989;">
                ギフト詳細
            </div>
            <div class="right" style="padding-right: 5%;">
                <button class="button" style="border-radius:30px;background: transparent;height:80%;line-height: initial;vertical-align: middle;font-size:12px;" onclick="detailReflesh();"><i class="fas fa-redo-alt fa-lg" style="color:#FF6070;"></i></button>
            </div>
        </ons-toolbar>
        <input type="hidden" id="other_user_id">
        <input type="hidden" id="gift_id">
        <input type="hidden" id="prev_page">
        <input type="hidden" id="detail_kakaku">
        <div class="container contents" style="background-color:#efeff4;padding-bottom:50px;">
            <!-- カードリスト部分 -->
            <div class="" style="width:100%;height: auto; padding: 1px 0 0 0;display: inline-block;">
                <div class="card" style="height:99%;margin:3px;border-radius:20px;padding:10px 20px 10px 20px;">
                    <div class="card__content" style="position: absolute;top:10;left:10;width:auto;min-width:50px;height:40px;border-radius: 20px 0px 20px 0px;color:white;text-align: center;background: -moz-linear-gradient(bottom left, #FF1048, #FFAA95);background: -webkit-linear-gradient(bottom left, #FF1048, #FFAA95);background: linear-gradient(to top right, #FF1048, #FFAA95);padding-right:10px;padding-left:10px;">
                        <span id="zaikoOtherDetail"style="line-height: 40px;">
                            残り：<span id="stock"></span>
                        </span>
                    </div>
                    <div id="gift_detail_image_other_zone"class="card__content" style="width:100% !important;">
                        <img id="gift_detail_image_other" class="gift_image_detail" src="img/loading.png" alt="" style="width:100%;height:329px;object-fit:cover;border-radius: 20px;">
                    </div>
                    <div class="card__content" style="height:auto;z-index:100;margin-top:-20px;">
                        <ul class="list" style="background-image:none;">
                        <li class="list-item" style="padding:0px;"onclick="document.getElementById('navi').bringPageTop('otherpage.html');otherPageUserId($('#other_user_id').val());">
                            <div class="list-item__left" style="padding:0px;">
                                <img id="gift_detail_user_image_other" class="list-item__thumbnail" src="img/human.png" alt="" style="border-radius: 50%;width:60px;height:60px;object-fit: cover;">
                            </div>
                        
                            <div class="list-item__center" style="padding:0px; padding-left:10px;">
                                <div id="gift_detail_username_other"class="" style="margin-top:20px;font-size: 20px;color:#898989;"></div>
                            </div>
                        </li>
                        </ul>
                    </div>
                    <div class="gift_icon" style="height:45px;font-size:12px;padding:5px;margin-top:8px;">
                        <div style="width:33%;float:left;text-align: center;"onclick="gift_favorite_button();">
                            <i id="gift_favorite_status" class="fa fa-heart favorite_off" style="font-size:20px;"></i>
                            <br>
                            <span id="gift_favorite_count" style="font-size:14px;color:#898989;">0</span>
                        </div>
                        <div id="share_button" class="" style="width:33%;float:left;text-align: center;" onclick="share($('#gift_id').val(),'giftPage');">
                            <i class="fab fa-hubspot" style="font-size:20px;color:gray;"></i>
                            <br>
                            <span style="font-size:14px;color:#898989;">共有</span>
                        </div>
                        <div class=""style="width:33%;float:left;text-align: center;" onclick="detailHoukoku();">
                            <i class="fab fa-font-awesome-flag"style="font-size:20px;color:gray;"></i>
                            <br>
                            <span style="font-size:14px;color:#898989;">報告</span>
                        </div>
                    </div>
                    <div id="gift_detail_title_other"class="gift_title" style="height:auto;font-size:16px;font-weight:bold;padding:10px 5px 10px 5px;"></div>
                    <div id="option_zone_other" style="width:100%;min-height:30px;">
                        <div id="gift_detail_lottery" style="display: none;margin:5px 0px;float:left;">
                            <span style="background-color: #FF6070;color:white;font-weight:bold;border-radius: 20px;padding:5px 10px;font-size:0.7em;">抽選販売</span>
                        </div>
                        <div id="gift_detail_ohitotu" style="display: none;margin:5px 0px;float:left;">
                            <span style="background-color: #FF6070;color:white;font-weight:bold;border-radius: 20px;padding:5px 10px;font-size:0.7em;">1人1個まで</span>
                        </div>
                        <div id="gift_detail_auction" style="display: none;margin:5px 0px;float:left;">
                            <span style="background-color: #FF6070;color:white;font-weight:bold;border-radius: 20px;padding:5px 10px;font-size:0.7em;">オークション商品(1品限定)</span>
                        </div>
                        <div id="gift_detail_fanpresent" style="display: none;margin:5px 0px;float:left;">
                            <span style="background-color: #FF6070;color:white;font-weight:bold;border-radius: 20px;padding:5px 10px;font-size:0.7em;">Fanランキング上位者限定ギフト！</span>
                        </div>
                        <div id="gift_detail_kakakufree" style="display: none;margin:5px 0px;float:left;">
                            <span style="background-color: #FF6070;color:white;font-weight:bold;border-radius: 20px;padding:5px 10px;font-size:0.7em;">価格自由</span>
                        </div>
                        <div id="gift_detail_datakind" style="display: none;margin:5px 0px;float:left;">
                        </div>
                        <div id="gift_detail_datalong" style="display: none;margin:5px 0px;float:left;">
                        </div>
                    </div>
                    <div id="gift_text_fanPresent_date_other"class="gift_text_fanPresent_date" style="width:100%;height:auto;font-size:0.7em;padding:10px 5px 10px 5px;display:none;color:#898989;"></div>
                    <div id="gift_detail_kakakufree_kaisetu"class="gift_detail_kakakufree_kaisetu" style="width:100%;height:auto;font-size:0.7em;padding:10px 5px 10px 5px;display:none;color:#898989;">※「価格自由」商品は購入者様が自由にお支払い金額を決定できる制度です(最低金額は1000円)。</div>
                    <div id="gift_detail_lottery_text"class="gift_detail_lottery" style="width:100%;height:auto;font-size:0.7em;padding:10px 5px 10px 5px;display:none;color:#898989;">※「抽選販売」は抽選終了時間までに応募したファンの方からランダムで当選者を選び、当選者のみが購入することができる商品です。</div>
                    <div id="gift_detail_text_other"class="gift_text" style="width:100%;height:auto;font-size:14px;padding:10px 5px 10px 5px;"></div>
                    <div id="gift_detail_time_other"class="gift_time" style="text-align:right;height:auto;font-size:10px;padding:10px 5px 10px 5px;"></div>
                </div>
            </div>
        </div>
        <div class="tabbar" style="background-color: #4B4B4B;position: fixed;bottom:0;left:0;">
            <div class="left" style="width:60%;float: left;color:white;padding-left:7%;">
                <span id="gift_detail_price_other" style="font-size: 24px;line-height:45px;"></span>
            </div>
            <div class="right" style="width:40%;padding-right:7%;">
                <button id="ReleaseStatusButton" class="button" style="background-color: #FF6070;width:100%;" onclick="buyPageOpen();">
                    購入手続き
                </button>
                <button id="nyusatuButton" class="button" style="background-color: #FF6070;width:100%;display:none;" onclick="nyusatuPageOpen();">
                    入札手続き
                </button>
                <button id="nyusatuEndButton" class="button" style="background: gray;width:100%;display:none;color:white;" onclick="alertNew('終了しているオークションです。落札者の方のみ購入手続きに進めます。','','');">
                        終了しました
                </button>
                <button id="presentButton" class="button" style="background-color: #FF6070;width:100%;display:none;" onclick="fanPresentPageOpen();">
                    受取手続き
                </button>
                <button id="presentEndButton" class="button" style="background: gray;width:100%;display:none;color:white;" onclick="alertNew('Fanランキング上位者限定商品です。恐れ入りますが受け取り資格がございません。','','');">
                        受け取れません
                </button>
                <button id="lotteryButton" class="button" style="background-color: #FF6070;width:100%;display:none;" onclick="lotteryPageOpen();">
                    応募する
                </button>
                <button id="lotteryEndButton" class="button" style="background: gray;width:100%;display:none;color:white;" onclick="alertNew('終了している抽選です。当選者の方のみ購入手続きに進めます。','','');">
                        抽選期間終了
                </button>
            </div>
        </div>
        <script>

            function detailReflesh(){
                showLoad();
                var gift_uid = $('#gift_id').val();
                var prev_page = $('#prev_page').val();
                var giftData = ncmb.DataStore("giftData");
                giftData
                .equalTo("giftUid", gift_uid)
                .fetch()               
                .then(function(results){
                        var object = results;
                        var gift_stock = object.get("stock");
                        var gift_title = object.get("giftTitle");
                        var gift_text = object.get("giftText");
                        var create_date = object.get("createDate");
                        var price = object.get("price");
                        var gift_user_id = object.get("userId");
                        var ReleaseStatus = object.get("ReleaseStatus");
                        var ohitotu = object.get("ohitotu");
                        var auction = object.get("auction");
                        var currentUser = ncmb.User.getCurrentUser();
                        var objectId = currentUser.get("objectId");
                        ncmb.User
                        .equalTo("objectId", gift_user_id)
                        .fetch()
                        .then(function(result){
                            var userName = result.get("userName");
                            giftIdJudge(gift_uid,userName,gift_title,gift_text,objectId,create_date,price,gift_user_id,gift_stock,ReleaseStatus,ohitotu,auction);
                            setTimeout(() => {
                                hideLoad();
                            }, 1000);
                        }).catch(function(){
                            setTimeout(() => {
                                hideLoad();
                            }, 1000);
                        });
                }).catch(function(){
                    setTimeout(() => {
                        hideLoad();
                    }, 1000);
                });
            }

            function buyPageOpen(){
                ons.notification.confirm({
                    message: '5分経ちましたら、購入権は破棄されますのでご注意ください。',
                    title: "購入手続き",
                    buttonLabels:["キャンセル","進む"],
                    callback: function(buttonIndex) {
                        if(buttonIndex==1){
                            buypage();
                        }
                    }
                });
            }
            
            function nyusatuPageOpen(){
                ons.notification.confirm({
                    message: '5分経ちましたら、入札権利は破棄されますのでご注意ください。',
                    title: "入札手続き",
                    buttonLabels:["キャンセル","進む"],
                    callback: function(buttonIndex) {
                        if(buttonIndex==1){
                            nyusatupage();
                        }
                    }
                });
            }
            function lotteryPageOpen(){
                ons.notification.confirm({
                    message: '当選した場合、3日以内に購入がない場合は他のお客様を繰り上げ当選と致しますことをご了承ください。',
                    title: "応募しますか？",
                    buttonLabels:["キャンセル","応募"],
                    callback: function(buttonIndex) {
                        if(buttonIndex==1){
                            lotterypage();
                        }
                    }
                });
            }

            function fanPresentPageOpen(){
                ons.notification.confirm({
                    message: '受け取り手続きへ',
                    title: "確認",
                    buttonLabels:["キャンセル","進む"],
                    callback: function(buttonIndex) {
                        if(buttonIndex==1){
                            fanPresentpage();
                        }
                    }
                });
            }

            function tweetOtherGift(){
                // どっちか使う
                var userName = $('#gift_detail_username_other').html();
                var link = 'http://twitter.com/share?url=https://fanfun/&text=ユーザー名：「'+userName+'」で検索！';
                window.open(link, '_system', 'location=yes');
                return false;
            }
            function detailHoukoku(){
                document.getElementById('navi').bringPageTop('houkokuForm.html');
                setTimeout(function(){
                    $('#houkokuform_gift_id').val($('#gift_id').val());
                    $('#houkokuform_gift_name').val($('#gift_detail_title_other').html());
                    $('#houkokuform_gift_username').val($('#gift_detail_username_other').html());
                }, 500);
            }

            var gift_image_detail = $('.gift_image_detail').width();
            $('.gift_image_detail').height(gift_image_detail);
            var gift_detail_image_other_zone = $('#gift_detail_image_other_zone').width();
            $('#gift_detail_image_other_zone').height(gift_detail_image_other_zone);
        </script>
        <style>
        .favorite_on{
            color:#FF6070;
        }
        .favorite_off{
            color:gray;
        }
        </style>
    </ons-page>